(function(a){a.fn.extend({ajaxReturn:function(){var b=arguments;var g=!1;return this.each(function(){a(this).off().on("click",function(){var j=a(this);if(b.length>1&&a.isFunction(b[0])&&b[0]()===false){f(h(j));return !1;}var m=h(j);var n=j.attr("href")||j.attr("target")||(m.attr("action")?m.attr("action"):undefined);var o=j.attr("method")||m.attr("method")||(m.length?"post":"get");var k=(j.attr("confirmation")===undefined||j.attr("confirmation")==="false")?!1:!0;var i=(m.attr("validation")===undefined||m.attr("validation")==="false")?!1:!0;var l=m.find("[name]").serialize();if(k){layer.confirm(j.attr("confirmation")?j.attr("confirmation"):"确定要执行该操作吗?",{btn:["确定","取消"],icon:3},function(p){layer.close(p);e(o,n,l);});return !1;}if(i){m.validater(function(p){var q=p.target;p.status?e(o,n,l):layer.alert(p.msg,{btn:["知道了"],icon:0},function(r){q.focus();layer.close(r);});});return !1;}if(j.attr("form")!==undefined&&!m.length){layer.msg("提交表单不存在！",{icon:0,time:1500});return !1;}if(!n){layer.msg("请求地址未定义！",{icon:0,time:1500});return !1;}e(o,n,l);f(m);return !1;});});function h(i){return i.attr("form")?a("[name="+i.attr("form")+"]"):i.closest("form");}function f(i){i.length&&i.get(0).tagName==="FORM"&&i.on("submit",function(){return !1;});}function e(l,k,j){if(g){return;}g=!0;var i=l==="jsonp"?l:"json";var l=l==="jsonp"?"get":l;d(!0);loadInd=layer.load();a[l](k,j,function(m){layer.close(loadInd);c(m);},i);}function c(i){var k=i.time?i.time*1000:1500;var j=b.length!=1?1:0;i.msg&&layer.msg(i.msg,{icon:i.code?6:5,time:k});i.url&&setTimeout(function(){window.location.href=i.url;},i.msg?k:0);a.isFunction(b[j])&&setTimeout(function(){b[j](i);},i.msg?k:0);setTimeout(function(){g=!1;},i.msg?k:0);}function d(i){var j={};a.ajaxPrefilter(function(l,o,n){var m=l.url;if(!j[m]){j[m]=n;}else{i?j[m].abort():n.abort();}var k=l.complete;l.complete=function(p,q){j[m]=null;if(a.isFunction(k)){k.apply(this,arguments);}};});}}});a("[ajaxReturn]").each(function(){a(this).attr("ajaxReturn")!=="false"&&a(this).ajaxReturn();});})(jQuery);